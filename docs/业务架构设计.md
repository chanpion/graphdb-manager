# 图数据库管理系统 - 业务架构设计

## 1. 业务架构概述

本系统采用**分层业务架构**，将图操作与图数据操作完全分离，实现职责清晰、易于维护和扩展的架构设计。整体架构分为七层：表示层、应用层、业务逻辑层、领域层、适配器层、持久层、基础设施层。

## 2. 分层架构设计

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                     表示层 (Presentation Layer)                      │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ Vue 3 前端 (UI Components + Pages)          │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                     应用层 (Application Layer)                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ RESTful API网关 (Controller + DTO)               │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                  业务逻辑层 (Business Logic Layer)               │
│  ┌──────────────────┐  ┌──────────────────┐             │
│  │ 图操作服务      │  │ 数据操作服务      │             │
│  │  (Graph Ops)    │  │  (Data Ops)      │             │
│  └──────────────────┘  └──────────────────┘             │
└─────────────────────────────────────────────────────────────────────┘
              ↓                ↓
┌─────────────────────────────────────────────────────────────┐
│                    领域层 (Domain Layer)                        │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 图领域模型 (Graph, Schema, Index)                   │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                   适配器层 (Adapter Layer)                    │
│  ┌─────────┐  ┌─────────┐  ┌──────────────┐      │
│  │ Neo4j    │  │ Nebula   │  │ JanusGraph   │      │
│  │ Adapter   │  │ Adapter  │  │ Adapter      │      │
│  └─────────┘  └─────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                   持久层 (Persistence Layer)                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ MySQL元数据 (Connection, GraphInstance, Schema)        │   │
│  │ 图数据库 (Neo4j, NebulaGraph, JanusGraph)          │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                基础设施层 (Infrastructure Layer)               │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 配置管理、日志、缓存、安全、工具类                     │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 层次职责

#### 2.2.1 表示层 (Presentation Layer)

**职责**：
- 接收用户输入和操作请求
- 展示业务数据和可视化界面
- 处理前端交互逻辑

**组成**：
- Vue 3 应用程序
- Element Plus UI组件
- D3.js 可视化组件
- API调用封装层

#### 2.2.2 应用层 (Application Layer)

**职责**：
- 接收前端HTTP请求
- 参数校验和转换
- 路由到对应业务服务
- 返回标准化响应

**组成**：
- RESTful Controller层
- DTO（Data Transfer Object）定义
- 异常处理器

#### 2.2.3 业务逻辑层 (Business Logic Layer)

**职责**：
- 编排业务流程
- 业务规则校验
- 协调多个领域服务
- 事务控制

**组成**：
- 图操作服务（GraphOperationService）
- 数据操作服务（DataOperationService）
- Schema管理服务（SchemaService）

#### 2.2.4 领域层 (Domain Layer)

**职责**：
- 定义核心业务模型
- 封装业务逻辑
- 与适配器层交互

**组成**：
- 图实体（Graph, GraphInstance）
- Schema实体（NodeType, EdgeType, Property, Index）
- 数据实体（Vertex, Edge）

#### 2.2.5 适配器层 (Adapter Layer)

**职责**：
- 封装不同图数据库的操作差异
- 实现统一接口
- 处理图数据库特定逻辑

**组成**：
- Neo4j适配器实现
- NebulaGraph适配器实现
- JanusGraph适配器实现

#### 2.2.6 持久层 (Persistence Layer)

**职责**：
- 数据持久化
- 数据访问抽象
- 连接管理

**组成**：
- MySQL数据访问（JPA Repository）
- 图数据库驱动（Driver/Client）

#### 2.2.7 基础设施层 (Infrastructure Layer)

**职责**：
- 提供横切关注点（日志、缓存、安全等）
- 工具类和配置管理
- 公共服务

**组成**：
- 日志服务
- 缓存服务（Redis）
- 加密服务
- 配置服务

## 3. 核心业务模块

### 3.1 连接管理模块

#### 3.1.1 模块职责

负责图数据库连接的创建、编辑、删除、测试和生命周期管理。

#### 3.1.2 核心功能

**连接配置管理**：
- 创建连接：用户填写连接参数，验证并保存
- 编辑连接：修改已有连接的配置信息
- 删除连接：删除连接配置及相关联的图实例信息
- 连接列表查询：分页查询所有连接配置

**连接测试**：
- 测试连接：验证连接参数是否正确
- 连接状态检测：定期检测连接是否存活
- 连接信息获取：测试成功后获取图数据库版本信息

**连接生命周期管理**：
- 连接启用/禁用：控制连接是否可用
- 连接优先级：设置连接的使用优先级
- 连接池管理：维护图数据库连接池

#### 3.1.3 业务流程

```
用户操作 → 填写连接表单 → 提交创建
  ↓
参数校验（必填、格式、范围）
  ↓
调用适配器测试连接
  ↓
测试成功 → 保存连接信息到MySQL
  ↓
返回连接ID → 前端显示成功提示
测试失败 → 显示错误信息
```

#### 3.1.4 模块边界

**输入**：
- 连接配置表单数据
- 连接ID（编辑、删除操作）

**输出**：
- 连接ID
- 连接信息（包含ID、名称、类型、状态）
- 连接列表

**依赖**：
- 适配器层（测试连接）
- 持久层（保存连接配置）

### 3.2 图操作模块

#### 3.2.1 模块职责

负责图实例的发现、创建、删除、切换以及图级别元数据的管理。**关键特点：图操作与图数据操作分离**。

#### 3.2.2 核心功能

**图发现**：
- 图列表获取：连接图数据库后，自动发现所有图实例
  - Neo4j：获取Database列表（社区版通常只有一个）
  - NebulaGraph：获取Space列表（支持多个）
  - JanusGraph：获取Graph列表（支持多个）
- 图统计信息：获取图的节点数、边数、创建时间等统计
- 图Schema缓存：将Schema信息缓存到MySQL，减少图数据库查询

**图实例管理**：
- 创建图：在图数据库中创建新图实例
  - NebulaGraph：创建新Space
  - JanusGraph：创建新Graph
  - Neo4j：提示使用企业版或通过Label区分逻辑图
- 删除图：删除指定图实例（删除前显示数据量警告）
- 切换图：在多图模式下切换到其他图实例
- 图详情查看：查看图的详细信息和统计

**图状态管理**：
- 图状态监控：监控图实例的健康状态
- 图使用统计：记录图的使用频率和操作日志
- 图快照：支持创建图快照（待扩展）

#### 3.2.3 业务流程

**图发现流程**：
```
连接图数据库 → 调用适配器获取图列表
  ↓
适配器查询图数据库元数据
  ↓
返回图信息列表 → 缓存到MySQL
  ↓
返回给前端 → 显示图列表和统计信息
```

**图切换流程**：
```
用户点击图实例 → 前端请求切换
  ↓
后端验证权限和图状态
  ↓
清空当前会话状态
  ↓
加载新图Schema → 缓存到Session
  ↓
返回图信息 → 前端更新界面
```

#### 3.2.4 模块边界

**输入**：
- 连接ID
- 图名称
- 图实例信息

**输出**：
- 图实例ID
- 图实例信息（名称、类型、统计、Schema）
- 图实例列表

**依赖**：
- 适配器层（图发现、图CRUD）
- Schema管理模块（获取图Schema）
- 持久层（缓存图元数据）

### 3.3 Schema管理模块

#### 3.3.1 模块职责

负责图Schema的定义和管理，包括节点类型、边类型、属性定义、索引管理的增删改查操作。

#### 3.3.2 核心功能

**节点类型管理**：
- 查询节点类型：获取图中所有节点类型列表
- 创建节点类型：定义新的节点类型及属性
- 编辑节点类型：修改节点类型名称和属性定义
- 删除节点类型：删除节点类型（检查是否有关联节点）

**边类型管理**：
- 查询边类型：获取图中所有边类型列表
- 创建边类型：定义新的边类型及属性
- 编辑边类型：修改边类型名称和属性定义
- 删除边类型：删除边类型（检查是否有关联边）

**属性定义管理**：
- 添加属性：为节点类型或边类型添加属性定义
- 编辑属性：修改属性的名称、类型、默认值等
- 删除属性：删除指定属性定义
- 属性类型：支持String, Integer, Long, Double, Boolean, Date

**索引管理**：
- 查询索引：获取图中所有索引列表
- 创建索引：为节点属性或边类型创建索引
- 删除索引：删除指定索引
- 索引类型：唯一索引、普通索引

#### 3.3.3 业务流程

**Schema同步流程**：
```
切换图实例 → 触发Schema同步
  ↓
调用适配器获取Schema
  ↓
转换Schema格式（统一格式）
  ↓
保存到MySQL缓存
  ↓
返回Schema信息 → 前端更新Schema视图
```

**Schema更新流程**：
```
用户修改Schema → 提交更新请求
  ↓
验证Schema变更（检查数据一致性）
  ↓
调用适配器更新Schema
  ↓
更新MySQL缓存
  ↓
返回更新结果 → 前端显示成功/失败
```

#### 3.3.4 模块边界

**输入**：
- 图名称
- Schema定义（节点类型、边类型、属性、索引）

**输出**：
- Schema信息（完整的Schema结构）
- Schema变更结果

**依赖**：
- 适配器层（Schema读写）
- 图操作模块（触发Schema同步）
- 持久层（Schema缓存）

### 3.4 数据操作模块

#### 3.4.1 模块职责

负责节点和边数据的增删改查操作。**关键特点：与图操作模块完全分离，专注于数据层面操作**。

#### 3.4.2 核心功能

**节点数据操作**：
- 查询节点：分页查询、条件筛选、模糊搜索
  - 分页查询：支持页码、每页大小
  - 筛选条件：按节点类型、按属性值、按创建时间
  - 排序：按创建时间、按属性值、按度数
- 创建节点：创建新节点
  - 自动生成UID：系统自动生成唯一标识符
  - 属性验证：根据Schema验证属性值
  - 必填检查：验证必填属性是否为空
- 编辑节点：更新节点属性和类型
  - 更新时间戳：自动更新updatedAt
  - 版本控制：保留节点更新历史（待扩展）
- 删除节点：删除指定节点
  - 级联删除：可配置是否删除关联边
  - 引用检查：删除前检查是否被边引用
- 批量操作：
  - 批量删除：选中多个节点批量删除
  - 批量导出：导出选中的节点数据

**边数据操作**：
- 查询边：分页查询、条件筛选、模糊搜索
  - 分页查询：支持页码、每页大小
  - 筛选条件：按边类型、按起始节点、按目标节点
  - 排序：按创建时间、按属性值
- 创建边：创建新边
  - 自动生成UID：系统自动生成唯一标识符
  - 引用验证：验证sourceUid和targetUid是否存在
  - 自环检查：可配置是否允许自环边
- 编辑边：更新边属性和类型
  - 更新时间戳：自动更新updatedAt
  - 端点修改：可修改起始节点或目标节点
- 删除边：删除指定边
  - 引用检查：删除前验证边的UID
- 批量操作：
  - 批量删除：选中多个边批量删除
  - 批量导出：导出选中的边数据

#### 3.4.3 业务流程

**节点查询流程**：
```
前端请求 → 接收查询参数（页码、筛选条件）
  ↓
构建查询条件（适配器查询语言）
  ↓
调用适配器查询节点
  ↓
转换数据格式（统一为Vertex模型）
  ↓
返回节点列表 → 前端展示
```

**节点创建流程**：
```
用户填写节点信息 → 提交创建请求
  ↓
Schema验证（验证节点类型和属性）
  ↓
生成UID（自动生成唯一标识符）
  ↓
调用适配器创建节点
  ↓
更新updatedAt时间
  ↓
返回节点信息 → 前端刷新列表
```

**边创建流程**：
```
用户填写边信息 → 选择起始节点和目标节点
  ↓
Schema验证（验证边类型和属性）
  ↓
引用验证（验证节点UID存在）
  ↓
生成UID（自动生成唯一标识符）
  ↓
调用适配器创建边
  ↓
更新updatedAt时间
  ↓
返回边信息 → 前端刷新列表
```

**批量删除流程**：
```
用户选择多个节点/边 → 点击批量删除
  ↓
显示确认对话框（显示将删除的数据量）
  ↓
确认删除 → 遍历删除每个元素
  ↓
调用适配器批量删除
  ↓
更新统计信息
  ↓
返回删除结果 → 前端刷新列表
```

#### 3.4.4 模块边界

**输入**：
- 图名称
- 查询条件（分页、筛选、排序）
- 节点/边数据（创建、编辑）

**输出**：
- 节点列表（分页）
- 边列表（分页）
- 节点/边信息（包含UID、属性）
- 操作结果（成功/失败）

**依赖**：
- 适配器层（数据CRUD）
- Schema管理模块（Schema验证）
- 持久层（无直接依赖，通过适配器操作图数据库）

### 3.5 数据导入导出模块

#### 3.5.1 模块职责

负责CSV文件的导入和图数据的导出功能。

#### 3.5.2 核心功能

**CSV导入**：
- 文件上传：支持点击上传和拖拽上传
- 文件解析：解析CSV格式文件（支持逗号、分号、Tab分隔符）
- 字段映射：将CSV列映射到节点/边的属性字段
- 数据验证：根据Schema验证导入数据
- 批量导入：分批写入图数据库
- 进度监控：实时显示导入进度和统计
- 错误处理：处理导入错误并提供错误日志

**数据导出**：
- CSV导出：导出节点或边数据为CSV格式
- JSON导出：导出图数据为JSON格式
- 图片导出：导出当前可视化视图为PNG/SVG图片
- 自定义导出：支持选择导出字段和格式

#### 3.5.3 业务流程

**CSV导入流程**：
```
用户上传CSV文件 → 前端解析并预览
  ↓
用户配置字段映射 → CSV列 → 属性字段
  ↓
选择导入选项 → 图实例、批量大小、错误处理策略
  ↓
提交导入请求 → 后端处理
  ↓
解析CSV文件 → 逐行读取数据
  ↓
Schema验证 → 验证数据类型、必填字段
  ↓
生成UID → 为每个节点/边生成唯一UID
  ↓
分批写入 → 调用适配器批量创建
  ↓
记录错误 → 收集导入失败的记录
  ↓
返回导入结果 → 成功数、失败数、错误日志
```

**数据导出流程**：
```
用户选择导出数据 → 选择导出范围和格式
  ↓
查询数据 → 调用适配器查询节点/边
  ↓
转换格式 → 根据导出格式转换数据
  ↓
生成文件 → 生成CSV/JSON/图片文件
  ↓
触发下载 → 前端下载文件
```

#### 3.5.4 模块边界

**输入**：
- CSV文件
- 字段映射配置
- 导入选项配置
- 导出范围配置

**输出**：
- 导入结果（成功数、失败数、进度信息）
- 导出文件
- 错误日志

**依赖**：
- 适配器层（批量写入）
- Schema管理模块（Schema验证）
- 数据操作模块（数据生成UID）

### 3.6 可视化模块

#### 3.6.1 模块职责

负责图数据的可视化展示，使用D3.js实现交互式图展示。

#### 3.6.2 核心功能

**图数据渲染**：
- 力导向布局：使用D3力导向算法自动布局
- 节点渲染：圆形节点，根据类型着色
- 边渲染：直线/曲线连线，根据类型着色
- 标签显示：显示节点名称和边名称
- 图例显示：显示节点类型和边类型的颜色图例

**交互功能**：
- 节点拖拽：拖动节点调整位置
- 画布缩放：鼠标滚轮缩放视图
- 画布平移：鼠标拖拽移动视图
- 节点点击：选中节点，高亮显示，显示属性面板
- 边点击：选中边，高亮显示，显示属性面板
- 右键菜单：显示上下文操作菜单（编辑、删除、展开等）

**高级可视化**：
- 节点展开：点击节点展开其邻居节点
- 路径高亮：选中两个节点高亮显示最短路径
- 子图展示：显示k度邻居子图
- 布局切换：切换力导向、圆形、分层、网格等布局
- 筛选显示：按节点类型、边类型筛选显示

#### 3.6.3 业务流程

**图数据加载流程**：
```
用户打开图可视化 → 前端请求图数据
  ↓
后端查询节点和边 → 调用适配器查询
  ↓
返回图数据 → 标准化为D3格式
  ↓
前端接收数据 → 传递给D3.js
  ↓
初始化力导向模拟 → 计算节点位置
  ↓
渲染图 → 渲染节点和边
  ↓
显示可视化 → 用户可交互操作
```

**节点展开流程**：
```
用户双击节点 → 触发展开操作
  ↓
查询邻居节点 → 调用适配器查询k度邻居
  ↓
返回邻居数据 → 包含节点和关联边
  ↓
前端渲染子图 → 在当前图中添加新节点
  ↓
更新布局 → 重新计算力导向布局
```

#### 3.6.4 模块边界

**输入**：
- 图名称
- 查询条件（节点数限制、筛选条件）
- 节点/边数据

**输出**：
- 图数据（节点列表、边列表、位置信息）
- 可视化配置（布局参数、样式配置）

**依赖**：
- 数据操作模块（查询图数据）
- 前端D3.js库（可视化渲染）

### 3.7 原生查询模块

#### 3.7.1 模块职责

负责通过图数据库的原生查询语句查询数据，支持Cypher（Neo4j）、nGQL（NebulaGraph）、Gremlin（JanusGraph）三种查询语言，提供友好的查询编辑器和结果展示界面。

#### 3.7.2 核心功能

**查询编辑器**：
- 代码编辑：支持语法高亮、代码补全、括号匹配、行号显示
- 查询语言支持：根据图数据库类型自动切换查询语言
- 查询模板：提供常用查询模板（基础查询、聚合查询、图算法）
- 查询历史：自动保存执行过的查询，支持快速加载
- 快捷键支持：Ctrl + Enter执行查询、Ctrl + /注释、Ctrl + S保存

**查询执行**：
- 查询执行：通过图数据库适配器执行原生查询语句
- 超时控制：支持配置查询超时时间（30/60/120/300秒）
- 结果限制：限制返回结果集大小（100/500/1000/5000条）
- 查询安全：防止注入攻击、限制查询复杂度、查询审计

**结果展示**：
- 表格展示：表格形式展示查询结果，支持排序、筛选、列宽调整
- 结果统计：显示执行时间、结果数量、查询状态、影响行数
- 结果导出：支持导出为CSV、JSON、Excel格式
- 特殊类型展示：节点/边数据特殊展示、数组数据展开、地理坐标格式化

**可视化结果**：
- 结果可视化：将查询结果转换为D3.js图可视化
- 自动识别：自动识别节点和边数据
- 可视化选项：选择节点/边类型、设置数量限制、选择布局算法
- 可视化导出：导出为PNG/SVG图片

**查询优化**：
- 查询分析：分析查询执行计划、识别性能瓶颈
- 性能指标：显示扫描节点/边数量、使用索引、内存使用
- 优化建议：建议创建索引、优化查询语句、使用高效模式

**批量查询**：
- 批量执行：支持执行多条查询语句（分号分隔）
- 查询脚本：支持上传/执行查询脚本文件
- 脚本管理：保存、加载、编辑查询脚本
- 结果报告：下载查询结果报告

#### 3.7.3 业务流程

**单次查询流程**：
```
用户输入查询语句 → 前端语法校验
  ↓
提交查询请求 → 后端接收查询
  ↓
查询安全检查 → 防注入、防复杂度超限
  ↓
调用适配器执行查询 → 传递给对应图数据库
  ↓
返回查询结果 → 标准化结果格式
  ↓
前端展示结果 → 表格展示 + 统计信息
  ↓
保存查询历史 → 记录查询语句和时间
```

**查询历史流程**：
```
用户点击查询历史 → 前端请求历史记录
  ↓
后端查询历史 → 从数据库/缓存读取
  ↓
返回历史列表 → 按时间倒序排列
  ↓
用户点击历史记录 → 加载查询语句到编辑器
  ↓
用户修改查询 → 可基于历史查询修改
  ↓
重新执行查询 → 保存新的历史记录
```

**可视化结果流程**：
```
用户点击"可视化" → 前端解析查询结果
  ↓
识别节点和边数据 → 提取节点列表和边列表
  ↓
转换为D3格式 → 标准化数据结构
  ↓
传递给可视化模块 → 调用D3.js渲染
  ↓
用户交互操作 → 拖拽、缩放、展开等
```

#### 3.7.4 模块边界

**输入**：
- 图名称（指定查询的图实例）
- 查询语句（原生查询语言）
- 查询参数（分页、超时、结果限制）

**输出**：
- 查询结果（表格数据、节点/边数据）
- 查询统计（执行时间、结果数量、性能指标）
- 查询优化建议（索引建议、优化提示）

**依赖**：
- 适配器层（执行原生查询）
- 数据操作模块（数据格式转换）
- 可视化模块（结果可视化）
- Schema管理模块（查询模板和语法提示）

## 4. 模块协作关系

### 4.1 依赖关系图

```
连接管理模块
    ↓
    ├─→ 图操作模块（发现图、切换图）
    │   ↓
    │   └─→ Schema管理模块（获取Schema）
    │       ↓
    │       └─→ 数据操作模块（Schema验证）
    │           ↓
    │           └─→ 可视化模块（提供数据）
    │               ↓
    │               └─→ 导入导出模块（导出数据）
    │
    └─→ 持久层（保存连接配置）
```

### 4.2 横向协作关系

**认证授权**：所有模块依赖认证服务
**日志服务**：所有模块依赖日志服务
**异常处理**：所有模块共享异常处理机制
**工具服务**：所有模块共享工具类（加密、校验、转换）

### 4.3 跨模块流程

**完整图探索流程**：
```
用户操作 → 连接管理（选择连接）
  ↓
        → 图操作模块（获取图列表）
  ↓
        → 用户选择图实例
  ↓
        → Schema管理模块（加载Schema）
  ↓
        → 数据操作模块（查询图数据）
  ↓
        → 可视化模块（展示图）
  ↓
        → 用户交互（点击节点、查询数据）
  ↓
        → 数据操作模块（执行查询/CRUD）
  ↓
        → 可视化模块（更新视图）
```

## 5. 业务边界

### 5.1 边界定义

**连接管理模块**：
- 负责连接配置的生命周期管理
- 不涉及图数据和Schema的细节
- 通过适配器接口与图数据库交互

**图操作模块**：
- 负责图实例的CRUD和Schema管理
- 不涉及具体节点和边的数据操作
- 提供Schema信息给其他模块使用

**Schema管理模块**：
- 负责Schema的定义和管理
- 验证Schema的完整性和一致性
- 为数据操作模块提供Schema验证服务

**数据操作模块**：
- 负责节点和边数据的CRUD
- 使用Schema进行数据验证
- 不管理图实例和Schema的定义

**可视化模块**：
- 负责图数据的可视化展示
- 从数据操作模块获取数据
- 不直接修改图数据库数据

**导入导出模块**：
- 负责数据的批量导入和导出
- 调用数据操作模块进行数据验证和生成UID
- 通过适配器模块进行批量写入

### 5.2 接口边界

**适配器接口**：
- 定义统一的图数据库操作接口
- 实现多图支持差异（Neo4j单图、Nebula/Janus多图）
- 处理特定图数据库的操作逻辑

**持久化接口**：
- 抽象数据访问接口
- MySQL用于元数据存储
- 图数据库通过适配器访问

## 6. 业务规则

### 6.1 数据一致性规则

**UID唯一性**：
- 所有节点的UID在同一个图实例中必须唯一
- 所有边的UID在同一个图实例中必须唯一
- 创建时自动检测UID冲突并提示用户

**引用完整性**：
- 边的sourceUid必须引用存在的节点
- 边的targetUid必须引用存在的节点
- 删除节点时检查是否被边引用

**Schema一致性**：
- 节点必须属于已定义的节点类型
- 边必须属于已定义的边类型
- 属性值必须符合Schema定义的数据类型
- 属性必填规则必须严格执行

### 6.2 业务流程规则

**连接管理规则**：
- 同一连接名称不允许重复
- 连接测试通过后才能保存
- 删除连接前需要确认

**图操作规则**：
- Neo4j社区版不允许创建新Database（提示使用企业版）
- NebulaGraph和JanusGraph支持创建多个图实例
- 删除图实例前需要检查数据量并警告用户

**数据操作规则**：
- 批量操作支持最多1000条数据
- 导入操作支持事务控制（全部成功或全部失败）
- 删除操作需要二次确认

### 6.3 权限控制规则

**操作权限**：
- Admin角色：所有操作权限
- Developer角色：连接管理、图管理、数据CRUD、Schema管理
- Analyst角色：查看连接、查看图、数据查询、数据导出
- 敏感操作（删除、导入）需要Admin或Developer角色

**数据可见性**：
- 连接密码加密存储，非管理员不可见明文
- 支持数据脱敏（可选配置）

## 7. 异常处理策略

### 7.1 异常分类

**连接异常**：
- ConnectionTestFailedException：连接测试失败
- ConnectionNotFoundException：连接不存在
- ConnectionConfigInvalidException：连接配置无效

**图操作异常**：
- GraphNotFoundException：图不存在
- GraphCreateFailedException：创建图失败
- GraphDeleteFailedException：删除图失败
- SchemaSyncFailedException：Schema同步失败

**数据操作异常**：
- VertexNotFoundException：节点不存在
- EdgeNotFoundException：边不存在
- UIDDuplicateException：UID重复
- ReferenceViolationException：引用完整性违规
- DataValidationException：数据验证失败

**导入导出异常**：
- CSVFormatException：CSV格式错误
- ImportFailedException：导入失败
- ExportFailedException：导出失败

### 7.2 异常处理流程

```
异常发生 → 记录错误日志
  ↓
转换异常为标准响应格式
  ↓
返回给前端 → 包含错误码和错误信息
  ↓
前端显示 → 错误提示对话框
```

## 8. 性能优化策略

### 8.1 缓存策略

**Schema缓存**：
- 将Schema信息缓存到MySQL，减少图数据库查询
- 设置合理的缓存过期时间（如1小时）
- 提供手动刷新缓存功能

**图数据缓存**：
- 查询结果缓存（Redis）
- 分页数据缓存（减少重复查询）
- 热点数据缓存

### 8.2 批量操作策略

**批量读取**：
- 支持批量查询节点和边
- 减少网络往返次数
- 合理设置批量大小（100/500/1000）

**批量写入**：
- CSV导入使用批量API
- 批量删除使用事务
- 控制批量大小避免内存溢出

### 8.3 分页策略

**分页查询**：
- 默认每页20条数据
- 支持自定义每页大小（10/20/50/100）
- 游进式加载或翻页加载

**虚拟滚动**：
- 大数据列表使用虚拟滚动技术
- 只渲染可见区域的数据
- 提升前端渲染性能
